### **Tutorial: Uso de Logging en Selenium con el Protocolo WebDriver Bidi**

Este tutorial se centra en cómo utilizar la clase `Log` de Selenium para acceder a las APIs de registro que utilizan el nuevo protocolo WebDriver Bidi. A través de este enfoque, los desarrolladores pueden monitorizar eventos y errores en sus aplicaciones web de manera más efectiva. A continuación, se detallan los aspectos teóricos y prácticos.

### **Teoría: ¿Qué es el Protocolo WebDriver Bidi?**

El **protocolo WebDriver Bidi** (Bidirectional) permite una comunicación más rica y eficiente entre el navegador y el script de automatización. A diferencia del protocolo tradicional, que es unidireccional, el protocolo Bidi permite el envío de eventos y la recepción de mensajes en ambas direcciones, lo que permite:

- Capturar errores de JavaScript en tiempo real.
- Escuchar eventos de mutación en el DOM.
- Realizar un seguimiento de los mensajes de la consola.

La clase `Log` en Selenium proporciona acceso a estas capacidades de registro y se utiliza para monitorizar eventos y errores durante la ejecución de pruebas automatizadas.

### **Uso Ético de Logging en Selenium**

Este tutorial se presenta desde la perspectiva de un "hacker ético", quien utilizaría estas herramientas para identificar y corregir errores en aplicaciones web. No se utilizará esta información para fines maliciosos.

### **Ejemplo Práctico: Captura de Errores de JavaScript**

#### **Objetivo:**
Escuchar errores de JavaScript en una página web y registrarlos.

#### **Paso 1: Preparar el Entorno**

1. **Instalar Selenium**:
   Asegúrate de tener Selenium instalado.
   ```bash
   pip install selenium
   ```

2. **Descargar el WebDriver**: Descarga el WebDriver adecuado para tu navegador (por ejemplo, ChromeDriver para Google Chrome).

#### **Paso 2: Crear una Página de Prueba**

Para probar la captura de errores de JavaScript, crea un archivo HTML simple llamado `test.html`:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prueba de Errores JS</title>
</head>
<body>
    <h1>Prueba de Errores de JavaScript</h1>
    <button id="throwing-mouseover">Causar Error</button>
    <script>
        document.getElementById('throwing-mouseover').onmouseover = function() {
            throw new Error('¡Este es un error de prueba!');
        };
    </script>
</body>
</html>
```

#### **Paso 3: Escribir el Script de Prueba**

A continuación, crea un script Python que utilizará Selenium para cargar la página y registrar los errores de JavaScript:

```python
from selenium import webdriver
from selenium.webdriver.common.by import By
import asyncio

async def main():
    # Inicializar el WebDriver
    driver = webdriver.Chrome(executable_path="/ruta/al/driver/chromedriver")

    # Cargar la página de prueba
    driver.get("file:///ruta/a/test.html")

    # Escuchar errores de JavaScript
    async with driver.log.add_js_error_listener() as error:
        # Hacer hover sobre el botón para provocar el error
        driver.find_element(By.ID, "throwing-mouseover").hover()

    # Comprobar si hubo errores
    if error:
        print("Error de JavaScript capturado:")
        print(error.exception_details.message)
    else:
        print("No se encontraron errores de JavaScript.")

    # Cerrar el navegador
    driver.quit()

# Ejecutar el script de prueba
asyncio.run(main())
```

#### **Explicación del Script:**

1. **Inicializar el WebDriver**: Se establece la conexión con el navegador.
2. **Cargar la Página**: Se carga la página de prueba que contiene un error JavaScript.
3. **Escuchar Errores de JavaScript**: Se utiliza el método `add_js_error_listener()` para capturar cualquier error de JavaScript que ocurra en la página.
4. **Provocar el Error**: Se provoca el error al pasar el ratón sobre el botón.
5. **Imprimir Resultados**: Se imprime el mensaje del error si se captura uno.

### **Ejemplo Práctico: Escuchar Eventos de Mutación**

#### **Objetivo:**
Monitorear eventos de mutación en el DOM y registrar cambios.

#### **Paso 1: Crear una Página de Prueba**

Crea otra página HTML llamada `mutation_test.html`:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prueba de Mutaciones</title>
</head>
<body>
    <h1>Prueba de Mutaciones en el DOM</h1>
    <button id="reveal">Revelar Texto</button>
    <div id="hidden" style="display:none;">¡Texto Revelado!</div>
    <script>
        document.getElementById('reveal').onclick = function() {
            document.getElementById('hidden').style.display = 'block';
        };
    </script>
</body>
</html>
```

#### **Paso 2: Escribir el Script de Prueba**

Modifica el script anterior para escuchar eventos de mutación:

```python
from selenium import webdriver
from selenium.webdriver.common.by import By
import asyncio

async def main():
    # Inicializar el WebDriver
    driver = webdriver.Chrome(executable_path="/ruta/al/driver/chromedriver")

    # Cargar la página de prueba
    driver.get("file:///ruta/a/mutation_test.html")

    # Escuchar eventos de mutación
    async with driver.log.mutation_events() as event:
        # Hacer clic en el botón para revelar el texto
        driver.find_element(By.ID, "reveal").click()

    # Comprobar los eventos de mutación
    print("Evento de mutación detectado:")
    print(f"Atributo: {event['attribute_name']}")
    print(f"Valor Actual: {event['current_value']}")
    print(f"Valor Anterior: {event['old_value']}")

    # Cerrar el navegador
    driver.quit()

# Ejecutar el script de prueba
asyncio.run(main())
```

#### **Explicación del Script:**

1. **Cargar la Página**: Se carga la página que contiene un botón para revelar un texto oculto.
2. **Escuchar Eventos de Mutación**: Se utiliza el método `mutation_events()` para monitorear cambios en el DOM.
3. **Interactuar con la Página**: Se hace clic en el botón para revelar el texto.
4. **Imprimir Resultados**: Se registran y muestran los eventos de mutación detectados.

### **Conclusión**

Este tutorial ha demostrado cómo usar la clase `Log` de Selenium con el protocolo WebDriver Bidi para monitorear errores de JavaScript y eventos de mutación en el DOM. Esta funcionalidad es valiosa para realizar pruebas exhaustivas y detectar errores en aplicaciones web, contribuyendo a un desarrollo más seguro y robusto. Recuerda siempre realizar pruebas de manera ética y con el consentimiento adecuado.