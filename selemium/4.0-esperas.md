### Introducción a los Esperas en Selenium

Cuando se automatizan aplicaciones web con Selenium, a menudo es necesario manejar la carga dinámica de los elementos. En muchos casos, el contenido de la página puede no estar listo cuando Selenium intenta interactuar con él, lo que lleva a errores como `ElementNotVisibleException`. Para solucionar este problema, Selenium ofrece dos tipos principales de "esperas" para controlar la sincronización: **esperas implícitas** y **esperas explícitas**.

Estas esperas permiten que Selenium espere hasta que ciertos elementos estén presentes o sean interactuables antes de proceder, mejorando la estabilidad de los scripts de prueba.

### 5.1. Esperas Explícitas

Las esperas explícitas permiten definir una condición específica para que Selenium espere hasta que esa condición se cumpla antes de continuar con la ejecución del script. Por ejemplo, se puede configurar para que espere a que un elemento esté visible en la página, que sea clicable o que el título de la página cambie a un valor específico.

#### Ejemplo de Uso

Para utilizar esperas explícitas, se combina la clase `WebDriverWait` con el módulo `expected_conditions`. El siguiente código muestra cómo hacerlo:

```python
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# Inicializar el navegador Firefox
driver = webdriver.Firefox()

# Abrir una página que tarda en cargar
driver.get("http://somedomain/url_that_delays_loading")

try:
    # Esperar hasta que el elemento esté presente en el DOM
    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.ID, "myDynamicElement"))
    )
finally:
    # Cerrar el navegador
    driver.quit()
```

En este ejemplo, el código espera hasta 10 segundos para que un elemento con el ID `"myDynamicElement"` esté presente en el DOM. Si no se encuentra el elemento en ese tiempo, se lanza una excepción `TimeoutException`.

#### Condiciones Comunes

Selenium proporciona muchas condiciones predefinidas que se pueden usar con las esperas explícitas. Algunas de las más útiles son:

- `title_is`: Espera que el título de la página sea un valor específico.
- `presence_of_element_located`: Espera que un elemento esté presente en el DOM.
- `visibility_of_element_located`: Espera que un elemento sea visible en la página.
- `element_to_be_clickable`: Espera que un elemento sea clicable.

### Ejemplo de Espera para un Elemento Clicable

```python
from selenium.webdriver.support import expected_conditions as EC

wait = WebDriverWait(driver, 10)
element = wait.until(EC.element_to_be_clickable((By.ID, 'someid')))
```

En este caso, el código esperará hasta que el elemento con el ID `'someid'` sea clicable.

### Condiciones de Espera Personalizadas

En algunos casos, las condiciones predefinidas no son suficientes. Es posible crear condiciones personalizadas implementando una clase con el método `__call__`, que devuelve `False` si la condición no se cumple.

#### Ejemplo de Condición Personalizada

```python
class element_has_css_class(object):
    """Una expectativa para comprobar que un elemento tiene una clase CSS específica."""

    def __init__(self, locator, css_class):
        self.locator = locator
        self.css_class = css_class

    def __call__(self, driver):
        # Encontrar el elemento con el localizador dado
        element = driver.find_element(*self.locator)
        # Comprobar si la clase CSS está en la lista de clases del elemento
        if self.css_class in element.get_attribute("class"):
            return element
        else:
            return False

# Esperar hasta que el elemento con id='myNewInput' tenga la clase 'myCSSClass'
wait = WebDriverWait(driver, 10)
element = wait.until(element_has_css_class((By.ID, 'myNewInput'), "myCSSClass"))
```

En este ejemplo, la clase `element_has_css_class` verifica si un elemento tiene una clase CSS específica antes de continuar.

### 5.2. Esperas Implícitas

Las esperas implícitas configuran Selenium para que busque un elemento en intervalos regulares durante un período específico. Esto se aplica a todas las operaciones de búsqueda de elementos que se realicen.

#### Ejemplo de Uso de Espera Implícita

```python
from selenium import webdriver

driver = webdriver.Firefox()
driver.implicitly_wait(10)  # Configura una espera implícita de 10 segundos
driver.get("http://somedomain/url_that_delays_loading")
myDynamicElement = driver.find_element_by_id("myDynamicElement")
```

En este ejemplo, Selenium intentará localizar el elemento `"myDynamicElement"` y continuará buscando hasta por 10 segundos antes de lanzar una excepción si el elemento no se encuentra.

### Comparación Entre Esperas Implícitas y Explícitas

- **Esperas Implícitas**: Aplican un tiempo de espera global para todas las búsquedas de elementos. Son fáciles de implementar, pero no permiten condiciones específicas.
- **Esperas Explícitas**: Permiten definir condiciones específicas y son más flexibles, pero requieren más configuración.

### Conclusión

El uso adecuado de las esperas en Selenium es fundamental para garantizar que los scripts de prueba sean robustos y funcionen de manera confiable en aplicaciones web con contenido dinámico. Las esperas explícitas y las condiciones personalizadas permiten manejar situaciones complejas, mientras que las esperas implícitas ofrecen una solución rápida y sencilla para casos menos específicos.