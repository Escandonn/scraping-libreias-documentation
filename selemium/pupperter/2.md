### Tutorial de Puppeteer: Interacciones en la página desde la teoría hasta la práctica

Puppeteer es una herramienta de automatización que permite interactuar con páginas web mediante programación. Utiliza una API para manejar el navegador Chrome o Chromium, lo que facilita la realización de pruebas automatizadas, scraping, generación de capturas de pantalla, y mucho más.

Este tutorial cubre los fundamentos de la interacción con elementos en una página web, desde la teoría hasta la práctica, utilizando Puppeteer.

---

### 1. **Instalación de Puppeteer**

Para comenzar, debes instalar Puppeteer en tu proyecto de Node.js. Ejecuta el siguiente comando en la terminal:

```bash
npm install puppeteer
```

### 2. **Conceptos básicos: Empezando con Puppeteer**

Para usar Puppeteer, primero debes abrir un navegador y una página. Aquí tienes un ejemplo básico para abrir un navegador y navegar a una página web:

```javascript
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch(); // Inicia el navegador
  const page = await browser.newPage(); // Abre una nueva pestaña
  await page.goto('https://example.com'); // Navega a la URL especificada

  // Cierra el navegador
  await browser.close();
})();
```

### 3. **Selección de elementos en Puppeteer**

Puppeteer permite seleccionar elementos usando selectores CSS y ofrece una API para trabajar con estos elementos. Los métodos principales incluyen `page.locator()`, que se recomienda para interactuar con elementos en la página.

- **Ejemplo de selección con un selector CSS:**
  
```javascript
// Selecciona un botón en la página
await page.locator('button').click();
```

### 4. **Interacciones con elementos**

#### 4.1. **Hacer clic en un elemento**

Para hacer clic en un botón, usa el método `.click()`:

```javascript
await page.locator('button').click(); // Hace clic en el botón seleccionado
```

#### 4.2. **Rellenar un campo de entrada**

Puppeteer puede llenar automáticamente campos de formulario. El método `.fill()` permite rellenar un campo de texto:

```javascript
await page.locator('input[name="username"]').fill('myUsername');
```

#### 4.3. **Pasar el mouse sobre un elemento**

Para pasar el ratón sobre un elemento, se usa el método `.hover()`:

```javascript
await page.locator('div.tooltip').hover(); // Pasa el mouse sobre un div con clase "tooltip"
```

#### 4.4. **Desplazarse por un elemento**

El método `.scroll()` permite desplazarse dentro de un elemento. Por ejemplo, para desplazar un `div`:

```javascript
await page.locator('div.scrollable').scroll({
  scrollLeft: 10,
  scrollTop: 20,
});
```

### 5. **Esperar por elementos**

Es común que algunos elementos no estén disponibles de inmediato en la página, por lo que Puppeteer ofrece funciones para esperar a que se carguen o sean visibles.

#### 5.1. **Esperar a que un elemento sea visible**

```javascript
await page.locator('.loading').wait(); // Espera a que el elemento con clase "loading" sea visible
```

#### 5.2. **Esperar a una condición personalizada**

En algunos casos, es necesario esperar a que se cumpla una condición específica. Puppeteer permite definir condiciones mediante funciones:

```javascript
await page
  .locator(() => {
    let resolve;
    const promise = new Promise(res => resolve = res);
    const observer = new MutationObserver(records => {
      for (const record of records) {
        if (record.target instanceof HTMLCanvasElement) {
          resolve(record.target);
        }
      }
    });
    observer.observe(document.body, { childList: true, subtree: true });
    return promise;
  })
  .wait();
```

### 6. **Filtros en locators**

Los filtros permiten agregar condiciones adicionales a un locator. Por ejemplo, hacer clic en un botón solo si su texto interior es "My button":

```javascript
await page
  .locator('button')
  .filter(button => button.innerText === 'My button')
  .click();
```

### 7. **Ejemplo práctico completo**

Combina todos los conceptos en un flujo de trabajo que realiza una interacción completa en una página web:

```javascript
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();

  await page.goto('https://example.com');
  
  // Esperar a que un botón específico esté visible y hacer clic en él
  await page.locator('button#startButton').wait();
  await page.locator('button#startButton').click();

  // Rellenar un formulario
  await page.locator('input[name="username"]').fill('myUsername');
  await page.locator('input[name="password"]').fill('myPassword');

  // Enviar el formulario
  await page.locator('button[type="submit"]').click();

  // Esperar la navegación
  await page.waitForNavigation();

  // Realizar alguna acción en la nueva página
  await page.locator('div.notification').hover();

  // Cierra el navegador
  await browser.close();
})();
```

Este script abre un navegador, navega a una página, interactúa con varios elementos y realiza algunas acciones en secuencia.

### Conclusión

Este tutorial proporciona una guía básica sobre cómo usar Puppeteer para automatizar interacciones en páginas web. Con las funciones de selección de elementos, interacción y espera de condiciones, Puppeteer es una herramienta potente para pruebas automatizadas y scraping.