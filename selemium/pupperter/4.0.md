### Configuración de Puppeteer: Teoría y Práctica

#### ¿Qué es Puppeteer?

Puppeteer es una biblioteca de Node.js que proporciona una API de alto nivel para automatizar el navegador Chrome o Chromium. Permite realizar tareas como pruebas de aplicaciones web, scraping de datos, generación de capturas de pantalla, y más. Por defecto, Puppeteer descarga una versión específica de Chrome para garantizar la compatibilidad con su API. Sin embargo, puedes personalizar la configuración para usar una versión diferente de Chrome, Firefox, o cambiar los ajustes de instalación y ejecución.

### Teoría de la Configuración

Puppeteer permite personalizar su comportamiento a través de dos métodos principales:
1. **Archivos de configuración**: Estos archivos proporcionan una forma recomendada de configurar Puppeteer. Los archivos pueden ser en formato JavaScript (CommonJS o ES Modules), JSON, o YAML.
2. **Variables de entorno**: Algunas opciones, como la configuración de proxies, solo se pueden personalizar mediante variables de entorno.

### Archivos de Configuración

Puppeteer busca archivos de configuración en el árbol de directorios con los siguientes nombres:
- `.puppeteerrc.cjs`
- `.puppeteerrc.js`
- `.puppeteerrc` (en formato YAML o JSON)
- `.puppeteerrc.json`
- `.puppeteerrc.yaml`
- `puppeteer.config.js`
- `puppeteer.config.cjs`

Los archivos de configuración permiten modificar diferentes opciones, como el directorio de caché, la versión del navegador a descargar, y más. Los cambios en la configuración pueden requerir la ejecución de scripts de post-instalación para que tengan efecto.

### Configuración Mediante Variables de Entorno

Las variables de entorno son otra forma de personalizar el comportamiento de Puppeteer. Algunas opciones solo se pueden configurar con variables de entorno, como:
- `HTTP_PROXY`, `HTTPS_PROXY`, `NO_PROXY`: Configuran los proxies HTTP utilizados para descargar y ejecutar el navegador.

Las variables de entorno siempre tienen prioridad sobre los archivos de configuración.

### Ejemplos de Configuración

#### 1. Usar Puppeteer con una versión personalizada de Chrome

Para utilizar una versión diferente de Chrome, debes especificar la ruta del ejecutable al crear una instancia del navegador:
```javascript
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch({
    executablePath: '/ruta/al/Chrome'
  });
  const page = await browser.newPage();
  await page.goto('https://example.com');
  await browser.close();
})();
```

#### 2. Descargar múltiples navegadores

A partir de la versión 23.0.0, Puppeteer permite descargar varios navegadores sin necesidad de ejecutar múltiples comandos.

**Archivo de configuración `project-directory/.puppeteerrc.cjs`:**
```javascript
/**
 * @type {import("puppeteer").Configuration}
 */
module.exports = {
  chrome: {
    skipDownload: false, // Descargar Chrome
  },
  firefox: {
    skipDownload: false, // Descargar Firefox
  },
};
```

Después de actualizar el archivo de configuración, ejecuta el siguiente comando para descargar los navegadores:
```bash
npx puppeteer browsers install
```

#### 3. Cambiar el directorio de caché predeterminado

A partir de la versión 19.0.0, Puppeteer almacena los navegadores en `~/.cache/puppeteer`. Para cambiar esta ubicación, configura el archivo `.puppeteerrc.cjs` de la siguiente manera:

**Archivo de configuración `project-directory/.puppeteerrc.cjs`:**
```javascript
const { join } = require('path');

/**
 * @type {import("puppeteer").Configuration}
 */
module.exports = {
  cacheDirectory: join(__dirname, '.cache', 'puppeteer'), // Cambiar la ubicación de la caché
};
```

Luego, reinstala Puppeteer para que los cambios surtan efecto:
```bash
npm install puppeteer
```

### Práctica: Configuración Paso a Paso

1. **Instalar Puppeteer**
   Instala Puppeteer en tu proyecto:
   ```bash
   npm install puppeteer
   ```

2. **Configurar Puppeteer con un archivo de configuración**
   Crea un archivo llamado `.puppeteerrc.cjs` en la raíz del proyecto con el siguiente contenido:
   ```javascript
   /**
    * @type {import("puppeteer").Configuration}
    */
   module.exports = {
     chrome: {
       skipDownload: false,
     },
     firefox: {
       skipDownload: true,
     },
     cacheDirectory: './.custom-cache',
   };
   ```

3. **Descargar navegadores según la configuración**
   Ejecuta el siguiente comando para instalar los navegadores según la configuración definida:
   ```bash
   npx puppeteer browsers install
   ```

4. **Ejecutar un script de prueba**
   Crea un archivo `testPuppeteer.js` y agrega el siguiente código:
   ```javascript
   const puppeteer = require('puppeteer');

   (async () => {
     const browser = await puppeteer.launch();
     const page = await browser.newPage();
     await page.goto('https://example.com');
     console.log('Página cargada');
     await browser.close();
   })();
   ```

5. **Ejecutar el script**
   Ejecuta el script con:
   ```bash
   node testPuppeteer.js
   ```

Con esta configuración, Puppeteer descargará y usará la versión especificada de Chrome y cambiará el directorio de caché al especificado en el archivo `.puppeteerrc.cjs`.

### Conclusión

Configurar Puppeteer mediante archivos y variables de entorno proporciona flexibilidad para personalizar la automatización del navegador según las necesidades del proyecto. Los archivos de configuración son la forma recomendada, ya que permiten gestionar múltiples opciones fácilmente.