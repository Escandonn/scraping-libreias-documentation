### Tutorial de Uso de Locators y waitForSelector en Puppeteer: Teoría y Práctica

#### 1. **Introducción a Puppeteer**
Puppeteer es una biblioteca de Node.js que proporciona una API de alto nivel para controlar navegadores Chrome o Chromium mediante el protocolo DevTools. Se usa comúnmente para tareas de scraping web, pruebas automatizadas y generación de capturas de pantalla o PDF de páginas web.

#### 2. **Concepto de Locator**
Los locators en Puppeteer son una forma avanzada de encontrar y manipular elementos en una página web. Facilitan la interacción con elementos que cumplen ciertas condiciones predefinidas. A diferencia de los selectores tradicionales (`page.click`, `page.type`, etc.), los locators proporcionan una forma más robusta y configurable para realizar acciones en la interfaz.

#### 3. **Cómo utilizar locators en Puppeteer**

##### 3.1 Filtrado de Locators
Los locators permiten añadir condiciones adicionales para que una acción se realice. Por ejemplo, puedes asegurarte de que el elemento a seleccionar tenga un texto específico.

```javascript
await page
  .locator('button')
  .filter(button => button.innerText === 'Mi botón')
  .click();
```
En este caso, solo se hará clic en el botón si su texto interno es 'Mi botón'.

##### 3.2 Devolviendo valores de un locator
Los locators también permiten transformar un elemento en un valor de JavaScript utilizando la función `map`.

```javascript
const habilitado = await page
  .locator('button')
  .map(button => !button.disabled)
  .wait();
```
Aquí, la variable `habilitado` contendrá un valor booleano indicando si el botón no está deshabilitado.

##### 3.3 Devolviendo ElementHandles desde un locator
Si necesitas trabajar con el objeto `ElementHandle` directamente, puedes usar la función `waitHandle`.

```javascript
const botonHandle = await page.locator('button').waitHandle();
await botonHandle.click();
```

#### 4. **Configuración de locators**
Puedes configurar los locators para ajustar sus opciones predeterminadas y precondiciones, como esperar o no la visibilidad del elemento, si está en el viewport o si está habilitado.

```javascript
await page
  .locator('button')
  .setEnsureElementIsInTheViewport(false)
  .setVisibility(null)
  .setWaitForEnabled(false)
  .setWaitForStableBoundingBox(false)
  .click();
```
El ejemplo anterior realiza un clic en un botón sin esperar a que se cumplan ciertas precondiciones.

#### 5. **Configuración del tiempo de espera para locators**
El tiempo de espera predeterminado se hereda de la configuración de la página, pero es posible establecerlo de manera específica para un locator.

```javascript
// Configura el timeout a 3 segundos.
await page.locator('button').setTimeout(3000).click();
```
Si el botón no se encuentra o no se cumplen las precondiciones dentro del tiempo establecido, se lanzará un error `TimeoutError`.

#### 6. **Eventos en locators**
Los locators pueden generar eventos para indicar cuándo se va a realizar una acción. Por ejemplo, se puede usar el evento `LocatorEvent.Action` para verificar si se cumplirá una acción como un clic.

```javascript
let seVaAHacerClick = false;
await page
  .locator('button')
  .on(LocatorEvent.Action, () => {
    seVaAHacerClick = true;
  })
  .click();
```

#### 7. **Uso de waitForSelector**
El método `waitForSelector` es una API de nivel inferior en comparación con los locators, y permite esperar a que un elemento esté disponible en el DOM. Es necesario gestionar manualmente la eliminación del `ElementHandle` resultante para evitar fugas de memoria.

```javascript
// Importar Puppeteer.
import puppeteer from 'puppeteer';

// Lanzar el navegador.
const browser = await puppeteer.launch();

// Crear una nueva página.
const page = await browser.newPage();

// Navegar a un sitio web.
await page.goto('TU_SITIO_WEB');

// Esperar a que el elemento esté disponible en el DOM.
const elemento = await page.waitForSelector('div > .nombre-clase');

// Realizar una acción con el elemento.
await elemento.click(); // Por ejemplo, hacer clic en el elemento.

// Liberar el handle.
await elemento.dispose();

// Cerrar el navegador.
await browser.close();
```

#### 8. **Consultas sin esperar**
Si ya sabes que los elementos están presentes en la página, puedes utilizar métodos de consulta rápida:

- `page.$()` devuelve un solo elemento que coincide con un selector.
- `page.$$()` devuelve todos los elementos que coinciden con un selector.
- `page.$eval()` ejecuta una función JavaScript en el primer elemento que coincide con un selector.
- `page.$$eval()` ejecuta una función en cada elemento que coincide con un selector.

```javascript
// Seleccionar un solo elemento.
const elementoUnico = await page.$('selector');

// Seleccionar múltiples elementos.
const elementos = await page.$$('selector');

// Ejecutar una función en el primer elemento que coincide.
const texto = await page.$eval('selector', el => el.innerText);

// Ejecutar una función en todos los elementos que coinciden.
const textos = await page.$$eval('selector', elementos => elementos.map(el => el.innerText));
```

#### 9. **Conclusión**
Con Puppeteer, tienes un control detallado sobre la automatización del navegador. Los locators ofrecen una manera avanzada y configurable de interactuar con elementos en una página web, mientras que los métodos tradicionales como `waitForSelector` y consultas rápidas son útiles para tareas más específicas. Ahora, ¡es momento de poner en práctica estos conceptos!